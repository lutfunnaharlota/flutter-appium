"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
Object.defineProperty(exports, "EnvVarAndPathCheck", {
  enumerable: true,
  get: function () {
    return _env.default;
  }
});
exports.default = exports.OptionalGstreamerCheck = exports.OptionalAppBundleCheck = exports.JavaOnPathCheck = exports.AndroidToolCheck = void 0;

require("source-map-support/register");

var _doctor = require("./doctor");

var _utils = require("./utils");

var _appiumSupport = require("appium-support");

var _path = _interopRequireDefault(require("path"));

var _env = _interopRequireDefault(require("./env"));

require("colors");

var _appiumAdb = require("appium-adb");

var _logger = _interopRequireDefault(require("./logger"));

let checks = [];
let javaHome = _appiumSupport.system.isWindows() ? '%JAVA_HOME%' : '$JAVA_HOME';
checks.push(new _env.default('ANDROID_HOME'));
checks.push(new _env.default('JAVA_HOME'));

class JavaOnPathCheck extends _doctor.DoctorCheck {
  async diagnose() {
    if (process.env.JAVA_HOME) {
      let javaHomeBin = _path.default.resolve(process.env.JAVA_HOME, 'bin');

      if (process.env.PATH.indexOf(javaHomeBin) + 1) {
        return (0, _utils.ok)(`Bin directory of ${javaHome} is set`);
      }
    }

    return (0, _utils.nok)(`Bin directory for ${javaHome} is not set`);
  }

  fix() {
    return `Add ${`'${javaHome}${_path.default.sep}bin'`.bold} to your ${'PATH'.bold} environment`;
  }

}

exports.JavaOnPathCheck = JavaOnPathCheck;

class AndroidToolCheck extends _doctor.DoctorCheck {
  constructor() {
    super();
    this.tools = ['adb', 'android', 'emulator'];
    this.noBinaries = [];
  }

  async diagnose() {
    const listOfTools = this.tools.join(', ');
    const sdkRoot = (0, _appiumAdb.getSdkRootFromEnv)();

    if (!sdkRoot) {
      return (0, _utils.nok)(`${listOfTools} could not be found because ANDROID_HOME or ANDROID_SDK_ROOT is NOT set!`);
    }

    _logger.default.info(`   Checking ${listOfTools}`);

    for (const binary of this.tools) {
      try {
        _logger.default.info(`     '${binary}' is in ${await (0, _appiumAdb.getAndroidBinaryPath)(binary)}`);
      } catch (e) {
        this.noBinaries.push(binary);
      }
    }

    if (this.noBinaries.length > 0) {
      return (0, _utils.nok)(`${this.noBinaries.join(', ')} could NOT be found in ${sdkRoot}!`);
    }

    return (0, _utils.ok)(`${listOfTools} exist: ${sdkRoot}`);
  }

  fix() {
    if (typeof process.env.ANDROID_HOME === 'undefined') {
      return `Manually configure ${'ANDROID_HOME'.bold} and run appium-doctor again.`;
    }

    return `Manually install ${this.noBinaries.join(', ').bold} and add it to ${'PATH'.bold}. ` + 'https://developer.android.com/studio#cmdline-tools and ' + 'https://developer.android.com/studio/intro/update#sdk-manager may help to setup.';
  }

}

exports.AndroidToolCheck = AndroidToolCheck;
checks.push(new AndroidToolCheck());
checks.push(new JavaOnPathCheck());

class OptionalAppBundleCheck extends _doctor.DoctorCheck {
  async diagnose() {
    const bundletoolPath = await (0, _utils.resolveExecutablePath)('bundletool.jar');
    return bundletoolPath ? (0, _utils.okOptional)(`bundletool.jar is installed at: ${bundletoolPath}`) : (0, _utils.nokOptional)('bundletool.jar cannot be found');
  }

  async fix() {
    return `${'bundletool.jar'.bold} is used to handle Android App Bundle. Please read http://appium.io/docs/en/writing-running-appium/android/android-appbundle/ to install it` + `${_appiumSupport.system.isWindows() ? '. Also consider adding the ".jar" extension into your PATHEXT environment variable in order to fix the problem for Windows' : ''}`;
  }

}

exports.OptionalAppBundleCheck = OptionalAppBundleCheck;
checks.push(new OptionalAppBundleCheck());

class OptionalGstreamerCheck extends _doctor.DoctorCheck {
  constructor(...args) {
    super(...args);
    this.GSTREAMER_BINARY = `gst-launch-1.0${_appiumSupport.system.isWindows() ? '.exe' : ''}`;
    this.GST_INSPECT_BINARY = `gst-inspect-1.0${_appiumSupport.system.isWindows() ? '.exe' : ''}`;
  }

  async diagnose() {
    const gstreamerPath = await (0, _utils.resolveExecutablePath)(this.GSTREAMER_BINARY);
    const gstInspectPath = await (0, _utils.resolveExecutablePath)(this.GST_INSPECT_BINARY);
    return gstreamerPath && gstInspectPath ? (0, _utils.okOptional)(`${this.GSTREAMER_BINARY} and ${this.GST_INSPECT_BINARY} are installed at: ${gstreamerPath} and ${gstInspectPath}`) : (0, _utils.nokOptional)(`${this.GSTREAMER_BINARY} and/or ${this.GST_INSPECT_BINARY} cannot be found`);
  }

  async fix() {
    return `${`${this.GSTREAMER_BINARY} and ${this.GST_INSPECT_BINARY}`.bold} are used to stream the screen of the device under test. ` + 'Please read https://appium.io/docs/en/writing-running-appium/android/android-screen-streaming/ to install them and for more details';
  }

}

exports.OptionalGstreamerCheck = OptionalGstreamerCheck;
checks.push(new OptionalGstreamerCheck());
var _default = checks;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9hbmRyb2lkLmpzIl0sIm5hbWVzIjpbImNoZWNrcyIsImphdmFIb21lIiwic3lzdGVtIiwiaXNXaW5kb3dzIiwicHVzaCIsIkVudlZhckFuZFBhdGhDaGVjayIsIkphdmFPblBhdGhDaGVjayIsIkRvY3RvckNoZWNrIiwiZGlhZ25vc2UiLCJwcm9jZXNzIiwiZW52IiwiSkFWQV9IT01FIiwiamF2YUhvbWVCaW4iLCJwYXRoIiwicmVzb2x2ZSIsIlBBVEgiLCJpbmRleE9mIiwiZml4Iiwic2VwIiwiYm9sZCIsIkFuZHJvaWRUb29sQ2hlY2siLCJjb25zdHJ1Y3RvciIsInRvb2xzIiwibm9CaW5hcmllcyIsImxpc3RPZlRvb2xzIiwiam9pbiIsInNka1Jvb3QiLCJsb2ciLCJpbmZvIiwiYmluYXJ5IiwiZSIsImxlbmd0aCIsIkFORFJPSURfSE9NRSIsIk9wdGlvbmFsQXBwQnVuZGxlQ2hlY2siLCJidW5kbGV0b29sUGF0aCIsIk9wdGlvbmFsR3N0cmVhbWVyQ2hlY2siLCJHU1RSRUFNRVJfQklOQVJZIiwiR1NUX0lOU1BFQ1RfQklOQVJZIiwiZ3N0cmVhbWVyUGF0aCIsImdzdEluc3BlY3RQYXRoIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7OztBQUFBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUVBLElBQUlBLE1BQU0sR0FBRyxFQUFiO0FBRUEsSUFBSUMsUUFBUSxHQUFHQyxzQkFBT0MsU0FBUCxLQUFxQixhQUFyQixHQUFxQyxZQUFwRDtBQUVBSCxNQUFNLENBQUNJLElBQVAsQ0FBWSxJQUFJQyxZQUFKLENBQXVCLGNBQXZCLENBQVo7QUFDQUwsTUFBTSxDQUFDSSxJQUFQLENBQVksSUFBSUMsWUFBSixDQUF1QixXQUF2QixDQUFaOztBQUdBLE1BQU1DLGVBQU4sU0FBOEJDLG1CQUE5QixDQUEwQztBQUN4QyxRQUFNQyxRQUFOLEdBQWtCO0FBQ2hCLFFBQUlDLE9BQU8sQ0FBQ0MsR0FBUixDQUFZQyxT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akIsc0JBQU9DLFNBQVAsS0FBcUIsNEhBQXJCLEdBQW9KLEVBQUcsRUFENUo7QUFFRDs7QUFYOEM7OztBQWFqREgsTUFBTSxDQUFDSSxJQUFQLENBQVksSUFBSTZCLHNCQUFKLEVBQVo7O0FBRUEsTUFBTUUsc0JBQU4sU0FBcUM1QixtQkFBckMsQ0FBaUQ7QUFBQTtBQUFBO0FBQUEsU0FDL0M2QixnQkFEK0MsR0FDM0IsaUJBQWdCbEMsc0JBQU9DLFNBQVAsS0FBcUIsTUFBckIsR0FBOEIsRUFBRyxFQUR0QjtBQUFBLFNBRS9Da0Msa0JBRitDLEdBRXpCLGtCQUFpQm5DLHNCQUFPQyxTQUFQLEtBQXFCLE1BQXJCLEdBQThCLEVBQUcsRUFGekI7QUFBQTs7QUFJL0MsUUFBTUssUUFBTixHQUFrQjtBQUNoQixVQUFNOEIsYUFBYSxHQUFHLE1BQU0sa0NBQXNCLEtBQUtGLGdCQUEzQixDQUE1QjtBQUNBLFVBQU1HLGNBQWMsR0FBRyxNQUFNLGtDQUFzQixLQUFLRixrQkFBM0IsQ0FBN0I7QUFFQSxXQUFPQyxhQUFhLElBQUlDLGNBQWpCLEdBQ0gsdUJBQVksR0FBRSxLQUFLSCxnQkFBaUIsUUFBTyxLQUFLQyxrQkFBbUIsc0JBQXFCQyxhQUFjLFFBQU9DLGNBQWUsRUFBNUgsQ0FERyxHQUVILHdCQUFhLEdBQUUsS0FBS0gsZ0JBQWlCLFdBQVUsS0FBS0Msa0JBQW1CLGtCQUF2RSxDQUZKO0FBR0Q7O0FBRUQsUUFBTXBCLEdBQU4sR0FBYTtBQUNYLFdBQVEsR0FBRyxHQUFFLEtBQUttQixnQkFBaUIsUUFBTyxLQUFLQyxrQkFBbUIsRUFBeEQsQ0FBMERsQixJQUFLLDJEQUFsRSxHQUNMLHFJQURGO0FBRUQ7O0FBaEI4Qzs7O0FBa0JqRG5CLE1BQU0sQ0FBQ0ksSUFBUCxDQUFZLElBQUkrQixzQkFBSixFQUFaO2VBR2VuQyxNIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRG9jdG9yQ2hlY2sgfSBmcm9tICcuL2RvY3Rvcic7XG5pbXBvcnQgeyBvaywgbm9rLCBva09wdGlvbmFsLCBub2tPcHRpb25hbCwgcmVzb2x2ZUV4ZWN1dGFibGVQYXRoIH0gZnJvbSAnLi91dGlscyc7XG5pbXBvcnQgeyBzeXN0ZW0gfSBmcm9tICdhcHBpdW0tc3VwcG9ydCc7XG5pbXBvcnQgcGF0aCBmcm9tICdwYXRoJztcbmltcG9ydCBFbnZWYXJBbmRQYXRoQ2hlY2sgZnJvbSAnLi9lbnYnO1xuaW1wb3J0ICdjb2xvcnMnO1xuaW1wb3J0IHsgZ2V0QW5kcm9pZEJpbmFyeVBhdGgsIGdldFNka1Jvb3RGcm9tRW52IH0gZnJvbSAnYXBwaXVtLWFkYic7XG5pbXBvcnQgbG9nIGZyb20gJy4vbG9nZ2VyJztcblxubGV0IGNoZWNrcyA9IFtdO1xuXG5sZXQgamF2YUhvbWUgPSBzeXN0ZW0uaXNXaW5kb3dzKCkgPyAnJUpBVkFfSE9NRSUnIDogJyRKQVZBX0hPTUUnO1xuXG5jaGVja3MucHVzaChuZXcgRW52VmFyQW5kUGF0aENoZWNrKCdBTkRST0lEX0hPTUUnKSk7XG5jaGVja3MucHVzaChuZXcgRW52VmFyQW5kUGF0aENoZWNrKCdKQVZBX0hPTUUnKSk7XG5cbi8vIENoZWNrIHRoYXQgdGhlIFBBVEggaW5jbHVkZXMgdGhlIGpkaydzIGJpbiBkaXJlY3RvcnlcbmNsYXNzIEphdmFPblBhdGhDaGVjayBleHRlbmRzIERvY3RvckNoZWNrIHtcbiAgYXN5bmMgZGlhZ25vc2UgKCkgeyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIHJlcXVpcmUtYXdhaXRcbiAgICBpZiAocHJvY2Vzcy5lbnYuSkFWQV9IT01FKSB7XG4gICAgICBsZXQgamF2YUhvbWVCaW4gPSBwYXRoLnJlc29sdmUocHJvY2Vzcy5lbnYuSkFWQV9IT01FLCAnYmluJyk7XG4gICAgICBpZiAocHJvY2Vzcy5lbnYuUEFUSC5pbmRleE9mKGphdmFIb21lQmluKSArIDEpIHtcbiAgICAgICAgcmV0dXJuIG9rKGBCaW4gZGlyZWN0b3J5IG9mICR7amF2YUhvbWV9IGlzIHNldGApO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gbm9rKGBCaW4gZGlyZWN0b3J5IGZvciAke2phdmFIb21lfSBpcyBub3Qgc2V0YCk7XG4gIH1cblxuICBmaXggKCkge1xuICAgIHJldHVybiBgQWRkICR7YCcke2phdmFIb21lfSR7cGF0aC5zZXB9YmluJ2AuYm9sZH0gdG8geW91ciAkeydQQVRIJy5ib2xkfSBlbnZpcm9ubWVudGA7XG4gIH1cbn1cblxuLy8gQ2hlY2sgdG9vbHNcbmNsYXNzIEFuZHJvaWRUb29sQ2hlY2sgZXh0ZW5kcyBEb2N0b3JDaGVjayB7XG4gIGNvbnN0cnVjdG9yICgpIHtcbiAgICBzdXBlcigpO1xuICAgIHRoaXMudG9vbHMgPSBbJ2FkYicsICdhbmRyb2lkJywgJ2VtdWxhdG9yJ107XG4gICAgdGhpcy5ub0JpbmFyaWVzID0gW107XG4gIH1cblxuICBhc3luYyBkaWFnbm9zZSAoKSB7XG4gICAgY29uc3QgbGlzdE9mVG9vbHMgPSB0aGlzLnRvb2xzLmpvaW4oJywgJyk7XG4gICAgY29uc3Qgc2RrUm9vdCA9IGdldFNka1Jvb3RGcm9tRW52KCk7XG4gICAgaWYgKCFzZGtSb290KSB7XG4gICAgICByZXR1cm4gbm9rKGAke2xpc3RPZlRvb2xzfSBjb3VsZCBub3QgYmUgZm91bmQgYmVjYXVzZSBBTkRST0lEX0hPTUUgb3IgQU5EUk9JRF9TREtfUk9PVCBpcyBOT1Qgc2V0IWApO1xuICAgIH1cblxuICAgIGxvZy5pbmZvKGAgICBDaGVja2luZyAke2xpc3RPZlRvb2xzfWApO1xuXG4gICAgZm9yIChjb25zdCBiaW5hcnkgb2YgdGhpcy50b29scykge1xuICAgICAgdHJ5IHtcbiAgICAgICAgbG9nLmluZm8oYCAgICAgJyR7YmluYXJ5fScgaXMgaW4gJHthd2FpdCBnZXRBbmRyb2lkQmluYXJ5UGF0aChiaW5hcnkpfWApO1xuICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICB0aGlzLm5vQmluYXJpZXMucHVzaChiaW5hcnkpO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmICh0aGlzLm5vQmluYXJpZXMubGVuZ3RoID4gMCkge1xuICAgICAgcmV0dXJuIG5vayhgJHt0aGlzLm5vQmluYXJpZXMuam9pbignLCAnKX0gY291bGQgTk9UIGJlIGZvdW5kIGluICR7c2RrUm9vdH0hYCk7XG4gICAgfVxuXG4gICAgcmV0dXJuIG9rKGAke2xpc3RPZlRvb2xzfSBleGlzdDogJHtzZGtSb290fWApO1xuICB9XG5cbiAgZml4ICgpIHtcbiAgICBpZiAodHlwZW9mIHByb2Nlc3MuZW52LkFORFJPSURfSE9NRSA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgIHJldHVybiBgTWFudWFsbHkgY29uZmlndXJlICR7J0FORFJPSURfSE9NRScuYm9sZH0gYW5kIHJ1biBhcHBpdW0tZG9jdG9yIGFnYWluLmA7XG4gICAgfVxuXG4gICAgcmV0dXJuIGBNYW51YWxseSBpbnN0YWxsICR7dGhpcy5ub0JpbmFyaWVzLmpvaW4oJywgJykuYm9sZH0gYW5kIGFkZCBpdCB0byAkeydQQVRIJy5ib2xkfS4gYCArXG4gICAgICAnaHR0cHM6Ly9kZXZlbG9wZXIuYW5kcm9pZC5jb20vc3R1ZGlvI2NtZGxpbmUtdG9vbHMgYW5kICcgK1xuICAgICAgJ2h0dHBzOi8vZGV2ZWxvcGVyLmFuZHJvaWQuY29tL3N0dWRpby9pbnRyby91cGRhdGUjc2RrLW1hbmFnZXIgbWF5IGhlbHAgdG8gc2V0dXAuJztcbiAgfVxufVxuY2hlY2tzLnB1c2gobmV3IEFuZHJvaWRUb29sQ2hlY2soKSk7XG5jaGVja3MucHVzaChuZXcgSmF2YU9uUGF0aENoZWNrKCkpO1xuXG5jbGFzcyBPcHRpb25hbEFwcEJ1bmRsZUNoZWNrIGV4dGVuZHMgRG9jdG9yQ2hlY2sge1xuICBhc3luYyBkaWFnbm9zZSAoKSB7XG4gICAgY29uc3QgYnVuZGxldG9vbFBhdGggPSBhd2FpdCByZXNvbHZlRXhlY3V0YWJsZVBhdGgoJ2J1bmRsZXRvb2wuamFyJyk7XG4gICAgcmV0dXJuIGJ1bmRsZXRvb2xQYXRoXG4gICAgICA/IG9rT3B0aW9uYWwoYGJ1bmRsZXRvb2wuamFyIGlzIGluc3RhbGxlZCBhdDogJHtidW5kbGV0b29sUGF0aH1gKVxuICAgICAgOiBub2tPcHRpb25hbCgnYnVuZGxldG9vbC5qYXIgY2Fubm90IGJlIGZvdW5kJyk7XG4gIH1cblxuICBhc3luYyBmaXggKCkgeyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIHJlcXVpcmUtYXdhaXRcbiAgICByZXR1cm4gYCR7J2J1bmRsZXRvb2wuamFyJy5ib2xkfSBpcyB1c2VkIHRvIGhhbmRsZSBBbmRyb2lkIEFwcCBCdW5kbGUuIFBsZWFzZSByZWFkIGh0dHA6Ly9hcHBpdW0uaW8vZG9jcy9lbi93cml0aW5nLXJ1bm5pbmctYXBwaXVtL2FuZHJvaWQvYW5kcm9pZC1hcHBidW5kbGUvIHRvIGluc3RhbGwgaXRgICtcbiAgICAgIGAke3N5c3RlbS5pc1dpbmRvd3MoKSA/ICcuIEFsc28gY29uc2lkZXIgYWRkaW5nIHRoZSBcIi5qYXJcIiBleHRlbnNpb24gaW50byB5b3VyIFBBVEhFWFQgZW52aXJvbm1lbnQgdmFyaWFibGUgaW4gb3JkZXIgdG8gZml4IHRoZSBwcm9ibGVtIGZvciBXaW5kb3dzJyA6ICcnfWA7XG4gIH1cbn1cbmNoZWNrcy5wdXNoKG5ldyBPcHRpb25hbEFwcEJ1bmRsZUNoZWNrKCkpO1xuXG5jbGFzcyBPcHRpb25hbEdzdHJlYW1lckNoZWNrIGV4dGVuZHMgRG9jdG9yQ2hlY2sge1xuICBHU1RSRUFNRVJfQklOQVJZID0gYGdzdC1sYXVuY2gtMS4wJHtzeXN0ZW0uaXNXaW5kb3dzKCkgPyAnLmV4ZScgOiAnJ31gO1xuICBHU1RfSU5TUEVDVF9CSU5BUlkgPSBgZ3N0LWluc3BlY3QtMS4wJHtzeXN0ZW0uaXNXaW5kb3dzKCkgPyAnLmV4ZScgOiAnJ31gO1xuXG4gIGFzeW5jIGRpYWdub3NlICgpIHtcbiAgICBjb25zdCBnc3RyZWFtZXJQYXRoID0gYXdhaXQgcmVzb2x2ZUV4ZWN1dGFibGVQYXRoKHRoaXMuR1NUUkVBTUVSX0JJTkFSWSk7XG4gICAgY29uc3QgZ3N0SW5zcGVjdFBhdGggPSBhd2FpdCByZXNvbHZlRXhlY3V0YWJsZVBhdGgodGhpcy5HU1RfSU5TUEVDVF9CSU5BUlkpO1xuXG4gICAgcmV0dXJuIGdzdHJlYW1lclBhdGggJiYgZ3N0SW5zcGVjdFBhdGhcbiAgICAgID8gb2tPcHRpb25hbChgJHt0aGlzLkdTVFJFQU1FUl9CSU5BUll9IGFuZCAke3RoaXMuR1NUX0lOU1BFQ1RfQklOQVJZfSBhcmUgaW5zdGFsbGVkIGF0OiAke2dzdHJlYW1lclBhdGh9IGFuZCAke2dzdEluc3BlY3RQYXRofWApXG4gICAgICA6IG5va09wdGlvbmFsKGAke3RoaXMuR1NUUkVBTUVSX0JJTkFSWX0gYW5kL29yICR7dGhpcy5HU1RfSU5TUEVDVF9CSU5BUll9IGNhbm5vdCBiZSBmb3VuZGApO1xuICB9XG5cbiAgYXN5bmMgZml4ICgpIHsgLy8gZXNsaW50LWRpc2FibGUtbGluZSByZXF1aXJlLWF3YWl0XG4gICAgcmV0dXJuIGAke2Ake3RoaXMuR1NUUkVBTUVSX0JJTkFSWX0gYW5kICR7dGhpcy5HU1RfSU5TUEVDVF9CSU5BUll9YC5ib2xkfSBhcmUgdXNlZCB0byBzdHJlYW0gdGhlIHNjcmVlbiBvZiB0aGUgZGV2aWNlIHVuZGVyIHRlc3QuIGAgK1xuICAgICAgJ1BsZWFzZSByZWFkIGh0dHBzOi8vYXBwaXVtLmlvL2RvY3MvZW4vd3JpdGluZy1ydW5uaW5nLWFwcGl1bS9hbmRyb2lkL2FuZHJvaWQtc2NyZWVuLXN0cmVhbWluZy8gdG8gaW5zdGFsbCB0aGVtIGFuZCBmb3IgbW9yZSBkZXRhaWxzJztcbiAgfVxufVxuY2hlY2tzLnB1c2gobmV3IE9wdGlvbmFsR3N0cmVhbWVyQ2hlY2soKSk7XG5cbmV4cG9ydCB7IEVudlZhckFuZFBhdGhDaGVjaywgQW5kcm9pZFRvb2xDaGVjaywgSmF2YU9uUGF0aENoZWNrLCBPcHRpb25hbEFwcEJ1bmRsZUNoZWNrLCBPcHRpb25hbEdzdHJlYW1lckNoZWNrIH07XG5leHBvcnQgZGVmYXVsdCBjaGVja3M7XG4iXSwiZmlsZSI6ImxpYi9hbmRyb2lkLmpzIiwic291cmNlUm9vdCI6Ii4uLy4uIn0=
